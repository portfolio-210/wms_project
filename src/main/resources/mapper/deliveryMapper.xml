<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wms_project.mapper.DeliveryMapper">
	
	<!-- 배송기사 등록 -->
	<insert id="deliveryInsert" parameterType="wms_project.dto.DeliveryDTO">
		INSERT INTO delivery (dcode,dspot,dname,dpass,demail,dhp,didnum,dimgnm,dimgrenm,dimgurl,dimgck,dapprove,ddate)
		VALUES (#{dcode},#{dspot},#{dname},#{dpass},#{demail},#{dhp},#{didnum},#{dimgnm},#{dimgrenm},#{dimgurl},#{dimgck},'근무중',now())
	</insert>
	
	<!-- 리스트 출력 -->
	<select id="deliveryList" resultType="wms_project.dto.DeliveryDTO" parameterType="String">
		SELECT didx, dcode, dspot, dname, demail, dhp, didnum, dimgck, dapprove
		FROM delivery 
		<where>
			 <if test="mspot != '본사'">
            	AND dspot = #{mspot}
        	</if>
		</where>
		ORDER BY didx DESC 
		LIMIT ${startno},${endno}
	</select>

	<!-- mspot 기준으로 DB 갯수 카운드 -->
	<select id="deliveryMspotCtn" resultType="String" parameterType="String">
		SELECT COUNT(*) AS ctn 
		FROM delivery
		WHERE dspot = #{mspot};	
	</select>


	<!-- 사원번호 자동생성 - DB 전체 카운드 -->
	<select id="deliveryCtn" resultType="String" parameterType="String">
		SELECT COUNT(*) AS ctn 
		FROM delivery		
	</select>
	
	<!-- 승인 -->
	 <update id="deliveryApprove"  parameterType="wms_project.dto.DeliveryDTO">
	 	UPDATE delivery
   	 	SET dapprove = #{dapprove}
    	WHERE didx = #{didx}
 	</update>
	
	
	

</mapper>
